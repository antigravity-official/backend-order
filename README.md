# 안티그래비티 백엔드 기술과제

## [피팅노트 서비스 주문서버 작성 과제]

## 개요

- 하나의 주문 Request 당 상품 black/XL 2개를 주문 할 것입니다.
- 기본으로 제공 해 드리는 코드를 바탕으로 추가 및 수정하여 코드를 완성 해 주세요.

## 제공소스코드 설명

1. 프로젝트를 실행하시면 request 값이 전달되어 (OrderRunner.java 참고)
    - OrderController.orderCreate() 함수가 실행 됩니다.
2. 총 request 회수는 200회 주문성공은 150회, 주문실패는 50회로 예상됩니다.
3. 구현언어는 JAVA 11입니다.

## 요구사항

1. 주문 API

- 주문관련, 재고관련 스키마 필요합니다.
- 주문완료 프로세스
    - 클라이언트에서 주문페이지 접속 시 제공된 상품정보를 통해 주문금액을 산출
    - 클라이언트에서 사용자중 일부는 임의의 포인트를 사용하여 결제금액이 달라집니다. (사용포인트는 직접 결정 해 주세요.)
    - 클라이언틑에서 PG사 프로그램을 통해 결제금액 카드결제 완료 후 서버로 주문 요청
    - 서버는 결제ID로 PG사 API를 호출하여 정상결제 되었는지 확인
    - 요청한 상품의 재고가 남아있는지 확인
    - [사용한 포인트] <= [보유포인트] 확인
    - 구매 가능한 재고정보를 다른사용자가 구매할 수 없도록 선차감
    - 모든 과정 실패 시 차감된 주문수량 복구
    - 주문완료
- 주문이 완료되어야 합니다.
    - 모든 주문생성 Request는 실제 결제가 이루어졌다고 가정합니다.
    - Mock 객체를 도출하여 PG사로부터 데이터를 받았다고 가정합니다.
    - 주문생성 실패 시 PG Mock 객체 API를 통해 결제취소 해야합니다.
    - 결제취소 시 결제금액만 취소되어야 합니다.
- 재고가 차감되어야 합니다.
    - 총 재고는 300개로 지정합니다.
    - 보유 재고수 만큼 주문이 생성되어야 합니다.
    - 재고수량이 없으면 주문정보는 생성 될 수 없습니다.
- 포인트가 차감되어야 합니다.
    - 상품가격 - 포인트 - 결제금액
    - 포인트가 없는 사용자는 사용할 수 없습니다.
    - 최소 결제금액은 1,000원 입니다.
    - 최소 사용가능 포인트는 1,000P 입니다.
    - 사용자별 보유 포인트 금액은 상이합니다.
    - 주문금액은 상품가격의 합산 금액입니다.

2. 결제내역 Detail API

- Request: 주문 ID
- Response(JSON): 상품정보
    - 상품명, 상품컬러, 상품사이즈, 상품금액, 주문개수, 실제 결제금액(상품 총금액 - 포인트 - 쿠폰할인금액), 할인금액(포인트 + 쿠폰할인금액)
- OrderDetailResponse.java 에 추가로 작성 해 주시면 됩니다.

## 산출물

- 테이블 스키마
- 클래스 다이어그램
- 시퀀스 다이어그램
- 소스코드 (PR)

## 제약사항

- 물리적 서버를 3대로 가정합니다.
- 데이터베이스는 1대로 가정합니다.
- 초당 request는 500회로 가정합니다.
- invariant, pre-condition, post-condition의 계약기반 프로그래밍을 구현 해야합니다.
- 코드 컨벤션은 인텔리J에서 기본으로 제공하는 JAVA 컨벤션을 따릅니다.
- 빌드툴은 Gradle을 사용합니다.
- Spring Boot의 설정정보는 yml 파일로 사용합니다.

## 고려사항

- 동시에 여러건의 주문 요청이 이루어짐으로 순차 처리가 필요합니다.
- 결제는 되었으나 주문 생성이 실패 할 경우 운영자들이 인지 할 수 있는 처리가 필요합니다.
